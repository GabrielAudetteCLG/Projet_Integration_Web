<main class="boutique-main">
  <div class="container boutique-searchbar-container">
    <div class="row my-3 justify-content-center">
      <div class="col-md-4">
        <form class="d-flex">
          <input
            class="form-control me-2 barre-de-recherche"
            type="search"
            placeholder="Recherche"
            aria-label="Recherche"
          />
          <button class="btn btn-outline-success" type="submit">
            <i class="fas fa-search"></i>
          </button>
        </form>
      </div>
      <div class="col-md-4">
        <div class="dropdown">
          <button
            class="btn btn-outline-secondary dropdown-toggle barre-de-recherche btn-outline-success"
            type="button"
            id="dropdownMenuButton1"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <i class="fas fa-filter"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
            <li><a class="dropdown-item" href="#">Option 1</a></li>
            <li><a class="dropdown-item" href="#">Option 2</a></li>
            <li><a class="dropdown-item" href="#">Option 3</a></li>
          </ul>
        </div>
      </div>
      <div class="col-md-4">
        <div class="dropdown">
          <button
            class="btn btn-outline-secondary dropdown-toggle barre-de-recherche btn-outline-success"
            type="button"
            id="dropdownMenuButton2"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <i class="bi bi-list-ul"></i> Catégorie
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton2">
            <li><a class="dropdown-item" href="#">Catégorie 1</a></li>
            <li><a class="dropdown-item" href="#">Catégorie 2</a></li>
            <li><a class="dropdown-item" href="#">Catégorie 3</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <% articles.forEach(function(article) { %>
  <div class="container boutique-article-container">
    <div class="container">
      <div class="product-wrapper">
        <h1><%= article.nom %></h1>
        <ul>
          <li><%= article.details %></li>

          <p><%= article.prix %></p>
        </ul>
        <div class="button" id="button">
          <div id="slide"></div>
          <a href="/#" id="ajout">J'achète</a>
        </div>
      </div>
    </div>
  </div>
  <% }); %>
</main>
<script>
  const ajout = document.getElementById("ajout");
  const parent_button = document.getElementById("button");
  const bg = document.getElementsByClassName("boutique-article-container")[0];
  const bgStyles = window.getComputedStyle(bg);
  const bgImage = bgStyles.backgroundImage;
  const panier = [];

  ajout.addEventListener("click", function (e) {
    e.preventDefault();
    const article = {
      nom: parent_button.parentNode.querySelector("h1").innerHTML,
      details: parent_button.parentNode.querySelector("li").innerHTML,
      prix: parent_button.parentNode.querySelector("p").innerHTML,
      imageFond: bgImage,
    };
    panier.push(article);

    // Send the panier variable to the server using AJAX
    const xhr = new XMLHttpRequest();
    xhr.open("POST", "/checkout");
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.send(JSON.stringify({ panier: panier }));

    xhr.onload = function () {
      if (xhr.status === 200) {
        window.location.href = "/checkout?panier=" + JSON.stringify(panier);
      }
    };
  });
</script>
